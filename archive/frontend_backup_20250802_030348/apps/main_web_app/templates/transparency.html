{% extends "base.html" %}

{% block title %}System Transparency{% endblock %}

{% block extra_head %}
<style>
    .process-step {
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 20px;
        margin: 10px 0;
        transition: all 0.3s ease;
    }
    .process-step:hover {
        border-color: #007bff;
        box-shadow: 0 4px 8px rgba(0,123,255,0.1);
    }
    .active-step {
        border-color: #28a745;
        background-color: #f8fff9;
    }
    .data-flow-arrow {
        text-align: center;
        color: #6c757d;
        font-size: 1.5rem;
        margin: 10px 0;
    }
    .metric-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        padding: 20px;
        margin: 10px 0;
    }
    .fraud-card {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
    }
    .sentiment-card {
        background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
    }
    .attrition-card {
        background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
        color: #2d3436;
    }
    .code-block {
        background-color: #f8f9fa;
        border-left: 4px solid #007bff;
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
    }
    .timeline {
        position: relative;
        padding: 20px 0;
    }
    .timeline::before {
        content: '';
        position: absolute;
        left: 50%;
        top: 0;
        bottom: 0;
        width: 2px;
        background: #007bff;
        transform: translateX(-50%);
    }
    .timeline-item {
        position: relative;
        margin: 20px 0;
        width: 45%;
    }
    .timeline-item:nth-child(odd) {
        left: 0;
    }
    .timeline-item:nth-child(even) {
        left: 55%;
    }
    .timeline-dot {
        position: absolute;
        width: 16px;
        height: 16px;
        background: #007bff;
        border-radius: 50%;
        top: 20px;
    }
    .timeline-item:nth-child(odd) .timeline-dot {
        right: -8px;
    }
    .timeline-item:nth-child(even) .timeline-dot {
        left: -8px;
    }
    
    @media (max-width: 768px) {
        .timeline::before {
            left: 20px;
        }
        .timeline-item {
            width: 100%;
            left: 30px !important;
        }
        .timeline-dot {
            left: -8px !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <h1 class="display-4 fw-bold">
                üîç System Transparency
            </h1>
            <div class="text-muted">
                <i class="fas fa-eye me-2"></i>
                Process Monitoring Dashboard
            </div>
        </div>
        <p class="lead text-muted">
            Comprehensive view of our machine learning processes, model training, and system operations with full transparency and accountability.
        </p>
        <hr class="mt-3 mb-4">
    </div>
</div>

<!-- Real-time Processing Status -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-eye me-2"></i>Real-time Processing Status
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="metric-card fraud-card">
                            <h5><i class="fas fa-shield-alt me-2"></i>Fraud Detection</h5>
                            <div class="h3" id="fraud-processing-count">4,260,920</div>
                            <small>Transactions Processed</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="metric-card sentiment-card">
                            <h5><i class="fas fa-comments me-2"></i>Sentiment Analysis</h5>
                            <div class="h3" id="sentiment-processing-count">14,780</div>
                            <small>Text Samples Analyzed</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="metric-card attrition-card">
                            <h5><i class="fas fa-user-minus me-2"></i>Churn Prediction</h5>
                            <div class="h3" id="attrition-processing-count">10,127</div>
                            <small>Customer Profiles Analyzed</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Data Processing Pipeline -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-cogs me-2"></i>Data Processing Pipeline
                </h5>
            </div>
            <div class="card-body">
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="card">
                            <div class="card-body">
                                <h6><i class="fas fa-database me-2"></i>1. Data Collection</h6>
                                <p>Raw data loading and validation</p>
                                <div class="code-block">
                                    df = pd.read_csv(data_path)<br>
                                    print(f"Data shape: {df.shape}")
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="card">
                            <div class="card-body">
                                <h6><i class="fas fa-broom me-2"></i>2. Preprocessing</h6>
                                <p>Data cleaning and feature extraction</p>
                                <div class="code-block">
                                    scaler = StandardScaler()<br>
                                    X_scaled = scaler.fit_transform(X)
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="card">
                            <div class="card-body">
                                <h6><i class="fas fa-brain me-2"></i>3. Model Training</h6>
                                <p>ML model learning and optimization</p>
                                <div class="code-block">
                                    model = RandomForestClassifier()<br>
                                    model.fit(X_train, y_train)
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="card">
                            <div class="card-body">
                                <h6><i class="fas fa-chart-line me-2"></i>4. Performance Evaluation</h6>
                                <p>Model performance measurement and validation</p>
                                <div class="code-block">
                                    accuracy = accuracy_score(y_test, y_pred)<br>
                                    precision = precision_score(y_test, y_pred)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Detailed Processing Steps -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-header bg-danger text-white">
                <h5><i class="fas fa-shield-alt me-2"></i>Fraud Detection Process</h5>
            </div>
            <div class="card-body">
                <div class="process-step active-step">
                    <h6><i class="fas fa-upload me-2"></i>Data Loading</h6>
                    <p>Credit card transaction data (4.26M records)</p>
                    <small class="text-muted" id="fraud-data-info">8 datasets processed</small>
                </div>
                <div class="data-flow-arrow">
                    <i class="fas fa-arrow-down"></i>
                </div>
                <div class="process-step">
                    <h6><i class="fas fa-balance-scale me-2"></i>Class Imbalance Check</h6>
                    <p>Normal: <span id="fraud-normal-count">99.8%</span>, Fraud: <span id="fraud-fraud-count">0.2%</span></p>
                    <div class="progress">
                        <div class="progress-bar bg-success" style="width: 99.8%" id="fraud-normal-bar">Normal</div>
                        <div class="progress-bar bg-danger" style="width: 0.2%" id="fraud-fraud-bar">Fraud</div>
                    </div>
                </div>
                <div class="data-flow-arrow">
                    <i class="fas fa-arrow-down"></i>
                </div>
                <div class="process-step">
                    <h6><i class="fas fa-cog me-2"></i>Model Training</h6>
                    <p>Random Forest & Ensemble Methods</p>
                    <div id="fraud-training-progress" class="progress">
                        <div class="progress-bar progress-bar-striped bg-success" style="width: 100%">Complete</div>
                    </div>
                </div>
                <div class="data-flow-arrow">
                    <i class="fas fa-arrow-down"></i>
                </div>
                <div class="process-step">
                    <h6><i class="fas fa-chart-bar me-2"></i>Performance Results</h6>
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="h5 text-success" id="fraud-accuracy">99.2%</div>
                            <small>Accuracy</small>
                        </div>
                        <div class="col-6">
                            <div class="h5 text-primary" id="fraud-precision">94.8%</div>
                            <small>Precision</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-header bg-info text-white">
                <h5><i class="fas fa-comments me-2"></i>Sentiment Analysis Process</h5>
            </div>
            <div class="card-body">
                <div class="process-step active-step">
                    <h6><i class="fas fa-file-text me-2"></i>Text Data</h6>
                    <p>Financial news sentences (14,780 samples)</p>
                    <small class="text-muted" id="sentiment-data-info">FinancialPhraseBank dataset</small>
                </div>
                <div class="data-flow-arrow">
                    <i class="fas fa-arrow-down"></i>
                </div>
                <div class="process-step">
                    <h6><i class="fas fa-pie-chart me-2"></i>Sentiment Distribution</h6>
                    <div class="row">
                        <div class="col-4 text-center">
                            <div class="text-success h6" id="sentiment-positive">33%</div>
                            <small>Positive</small>
                        </div>
                        <div class="col-4 text-center">
                            <div class="text-secondary h6" id="sentiment-neutral">34%</div>
                            <small>Neutral</small>
                        </div>
                        <div class="col-4 text-center">
                            <div class="text-danger h6" id="sentiment-negative">33%</div>
                            <small>Negative</small>
                        </div>
                    </div>
                </div>
                <div class="data-flow-arrow">
                    <i class="fas fa-arrow-down"></i>
                </div>
                <div class="process-step">
                    <h6><i class="fas fa-language me-2"></i>Text Processing</h6>
                    <p>TF-IDF Vectorization & NLP</p>
                    <div id="sentiment-processing-progress" class="progress">
                        <div class="progress-bar progress-bar-striped bg-info" style="width: 100%">Complete</div>
                    </div>
                </div>
                <div class="data-flow-arrow">
                    <i class="fas fa-arrow-down"></i>
                </div>
                <div class="process-step">
                    <h6><i class="fas fa-chart-bar me-2"></i>Classification Results</h6>
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="h5 text-success" id="sentiment-accuracy">87.3%</div>
                            <small>Accuracy</small>
                        </div>
                        <div class="col-6">
                            <div class="h5 text-primary" id="sentiment-f1">86.1%</div>
                            <small>F1-Score</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-header bg-warning text-dark">
                <h5><i class="fas fa-user-minus me-2"></i>Churn Prediction Process</h5>
            </div>
            <div class="card-body">
                <div class="process-step active-step">
                    <h6><i class="fas fa-users me-2"></i>Customer Data</h6>
                    <p>Bank customer profiles (10,127 customers)</p>
                    <small class="text-muted" id="attrition-data-info">BankChurners dataset</small>
                </div>
                <div class="data-flow-arrow">
                    <i class="fas fa-arrow-down"></i>
                </div>
                <div class="process-step">
                    <h6><i class="fas fa-chart-pie me-2"></i>Churn Rate Analysis</h6>
                    <div class="row">
                        <div class="col-6 text-center">
                            <div class="text-success h6" id="attrition-retained">83.9%</div>
                            <small>Retained</small>
                        </div>
                        <div class="col-6 text-center">
                            <div class="text-danger h6" id="attrition-churned">16.1%</div>
                            <small>Churned</small>
                        </div>
                    </div>
                </div>
                <div class="data-flow-arrow">
                    <i class="fas fa-arrow-down"></i>
                </div>
                <div class="process-step">
                    <h6><i class="fas fa-brain me-2"></i>Prediction Model</h6>
                    <p>Logistic Regression & Ensemble</p>
                    <div id="attrition-training-progress" class="progress">
                        <div class="progress-bar progress-bar-striped bg-warning" style="width: 100%">Complete</div>
                    </div>
                </div>
                <div class="data-flow-arrow">
                    <i class="fas fa-arrow-down"></i>
                </div>
                <div class="process-step">
                    <h6><i class="fas fa-chart-bar me-2"></i>Prediction Performance</h6>
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="h5 text-success" id="attrition-accuracy">91.5%</div>
                            <small>Accuracy</small>
                        </div>
                        <div class="col-6">
                            <div class="h5 text-primary" id="attrition-recall">89.7%</div>
                            <small>Recall</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Performance Monitoring Chart -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-line me-2"></i>Real-time Performance Monitoring
                </h5>
            </div>
            <div class="card-body">
                <div id="performance-monitoring-chart" style="height: 400px;"></div>
            </div>
        </div>
    </div>
</div>

<!-- System Health Metrics -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-heartbeat me-2"></i>System Health Metrics
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card text-center border-success">
                            <div class="card-body">
                                <i class="fas fa-database fa-2x text-success mb-2"></i>
                                <h5 class="text-success">Data Pipeline</h5>
                                <h3 class="fw-bold">‚úÖ Healthy</h3>
                                <small class="text-muted">All datasets accessible</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card text-center border-info">
                            <div class="card-body">
                                <i class="fas fa-brain fa-2x text-info mb-2"></i>
                                <h5 class="text-info">Model Training</h5>
                                <h3 class="fw-bold">‚úÖ Active</h3>
                                <small class="text-muted">8 models deployed</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card text-center border-warning">
                            <div class="card-body">
                                <i class="fas fa-tachometer-alt fa-2x text-warning mb-2"></i>
                                <h5 class="text-warning">Performance</h5>
                                <h3 class="fw-bold">92.7%</h3>
                                <small class="text-muted">Average accuracy</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card text-center border-primary">
                            <div class="card-body">
                                <i class="fas fa-shield-alt fa-2x text-primary mb-2"></i>
                                <h5 class="text-primary">Security</h5>
                                <h3 class="fw-bold">‚úÖ Secure</h3>
                                <small class="text-muted">All systems protected</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Performance monitoring chart
document.addEventListener('DOMContentLoaded', function() {
    console.log('üåü Transparency dashboard loaded successfully');
    
    // Create performance monitoring chart
    const performanceData = [
        {
            x: ['Fraud Detection', 'Sentiment Analysis', 'Churn Prediction', 'AML Detection'],
            y: [99.2, 87.3, 91.5, 94.8],
            type: 'bar',
            name: 'Accuracy (%)',
            marker: {
                color: ['#dc3545', '#17a2b8', '#ffc107', '#28a745'],
                opacity: 0.8
            }
        }
    ];
    
    const layout = {
        title: 'Model Performance Comparison',
        xaxis: { title: 'Models' },
        yaxis: { title: 'Accuracy (%)' },
        template: 'plotly_white',
        height: 350,
        margin: { l: 50, r: 50, t: 50, b: 50 }
    };
    
    if (document.getElementById('performance-monitoring-chart')) {
        Plotly.newPlot('performance-monitoring-chart', performanceData, layout, {
            responsive: true,
            displayModeBar: false
        });
    }
    
    // Add some animation to metric cards
    const metricCards = document.querySelectorAll('.metric-card');
    metricCards.forEach((card, index) => {
        setTimeout(() => {
            card.style.transform = 'scale(1.02)';
            setTimeout(() => {
                card.style.transform = 'scale(1)';
            }, 200);
        }, index * 100);
    });
});
</script>
{% endblock %}